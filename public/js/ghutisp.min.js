function drawghuti() {
    for (let j = 1; j < 5; j++)
        for (let i = 1; i < 5; i++) {
            let ghutiid = "p" + j + "g" + i;
            updateghuti(j, i, ghutiid, 0);
        }
}

function hideghuti(ply) {
    if (ply == 2) pos[11] = [];
    else if (ply == 4) {
        pos[15] = [];
    }
    for (let i = 1; i < 5; i++) {
        let ghutiid = "p" + ply + "g" + i;
        let circle = documentelemId[ghutiid];
        if (circle) {
            circle.style.display = "None";
        }
    }
}

function updatezindex(ply) {
    for (let i = 1; i < 5; i++) {
        let s = "p" + ply + "g" + i;
        documentelemId[s].style.zIndex = 7;
    }
}

function updateghuti(player, ghuti, ghutiid, bxn) {
    if (bxn) bxn--;
    else bxn = playermap[player][ghutipos[player][ghuti]] - 1;
    let row = Math.floor(bxn / 5),
        col = bxn % 5;
    let posy = starty + row * boxheight + boxheight / 2,
        posx = startx + col * boxwidth + boxwidth / 2;
    if (ghuti == 1) {
        posx -= (ghutisize + 3);
        posy -= (ghutisize + 3);
    } else if (ghuti == 2) {
        posx += 3;
        posy -= (ghutisize + 3);
    } else if (ghuti == 3) {
        posx -= (ghutisize + 3);
        posy += 3;
    } else if (ghuti == 4) {
        posx += 3;
        posy += 3;
    }
    let circle = documentelemId[ghutiid];
    posx = Math.ceil(Math.round(posx));
    posy = Math.ceil(Math.round(posy));
    if (circle) {
        circle.style.top = posy + "px";
        circle.style.left = posx + "px";
    }
}

function updateposghuti() {
    for (let bxn = 1; bxn < 26; bxn++) {
        let ln = pos[bxn].length;
        if (ln) {
            if (pos[bxn].length == 1) update1(bxn);
            else if (pos[bxn].lenght == 2) update2(bxn);
            else if (pos[bxn].length == 4 || pos[bxn].length == 3) update4(bxn);
            else if (pos[bxn].length >= 5) updategreater4(bxn);
        }
    }
}

function updatebox(bxn) {
    if (pos[bxn].length == 1) update1(bxn);
    else if (pos[bxn].lenght == 2) update2(bxn);
    else if (pos[bxn].length == 4 || pos[bxn].length == 3) update4(bxn);
    else if (pos[bxn].length >= 5) updategreater4(bxn);
}

function update2(bxn) {
    bxn--;
    let row = Math.floor(bxn / 5),
        col = bxn % 5;
    let posy = starty + row * boxheight + boxheight / 2,
        posx = startx + col * boxwidth + boxwidth / 2;
    let circle = documentelemId[pos[bxn + 1][0]];
    let posx1 = Math.ceil(Math.round(posx - ghutisize - 3));
    let posy1 = Math.ceil(Math.round(posy - ghutisize / 2 - 3));
    if (circle) {
        circle.style.top = posy1 + "px";
        circle.style.left = posx1 + "px";
    }
    circle = documentelemId[pos[bxn + 1][1]];
    posx = Math.ceil(Math.round(posx + 3));
    posy = Math.ceil(Math.round(posy - ghutisize / 2 - 3));
    if (circle) {
        circle.style.top = posy + "px";
        circle.style.left = posx + "px";
    }
}

function update4(bxn) {
    pos[bxn].sort();
    for (let i = 0; i < pos[bxn].length; i++) {
        updateghuti(parseInt(pos[bxn][i].charAt(1)), i + 1, pos[bxn][i], bxn);
    }
}

function update1(bxn) {
    bxn--;
    let row = Math.floor(bxn / 5),
        col = bxn % 5;
    let posy = starty + row * boxheight + boxheight / 2,
        posx = startx + col * boxwidth + boxwidth / 2;
    let circle = documentelemId[pos[bxn + 1][0]];
    posx = Math.ceil(Math.round(posx - ghutisize / 2));
    posy = Math.ceil(Math.round(posy - ghutisize / 2));
    if (circle) {
        circle.style.top = posy + "px";
        circle.style.left = posx + "px";
    }
}

function updategreater4(bxn) {
    let ghutino = {
        1: 0,
        2: 0,
        3: 0,
        4: 0
    };
    if (pos[bxn].length > 1) pos[bxn].sort();
    let pltype = pos[bxn][0].charAt(1);
    let flg = false;
    for (let i = 1; i < pos[bxn].length; i++) {
        if (pltype != pos[bxn][i].charAt(1)) {
            flg = true;
        }
    }
    for (let i = 0; i < pos[bxn].length; i++) {
        let bxno = bxn - 1;
        let row = Math.floor(bxno / 5),
            col = bxno % 5;
        let posy = starty + row * boxheight + boxheight / 2,
            posx = startx + col * boxwidth + boxwidth / 2;
        let ghuti = parseInt(pos[bxn][i].charAt(1));
        let no = parseInt(pos[bxn][i].charAt(1));
        if (flg) {
            if (ghuti == 1) {
                posx -= (ghutisize + 3);
            } else if (ghuti == 3) {
                posx += 3;
            }
        } else {
            posx -= ghutisize / 2;
            posy -= ghutisize / 2;
        }
        let j = ghutino[no] - 1;
        posx += j * 5;
        posy += j * 5;
        ghutino[no]++;
        let circle = documentelemId[pos[bxn][i]];
        posx = Math.ceil(Math.round(posx));
        posy = Math.ceil(Math.round(posy));
        if (circle) {
            circle.style.top = posy + "px";
            circle.style.left = posx + "px";
        }
    }
}